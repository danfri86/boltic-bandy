/* global postL10n, ajaxurl, wpAjax, setPostThumbnailL10n, postboxes, pagenow, tinymce, alert, deleteUserSetting, getUserSetting, setUserSetting *//* global theList:true, theExtraList:true, autosave:true */function array_unique_noempty(e){var t=[];jQuery.each(e,function(e,n){n=jQuery.trim(n);n&&jQuery.inArray(n,t)==-1&&t.push(n)});return t}var tagBox,commentsBox,editPermalink,makeSlugeditClickable,WPSetThumbnailHTML,WPSetThumbnailID,WPRemoveThumbnail,wptitlehint;(function(e){tagBox={clean:function(e){var t=postL10n.comma;","!==t&&(e=e.replace(new RegExp(t,"g"),","));e=e.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");","!==t&&(e=e.replace(/,/g,t));return e},parseTags:function(t){var n=t.id,r=n.split("-check-num-")[1],i=e(t).closest(".tagsdiv"),s=i.find(".the-tags"),o=postL10n.comma,u=s.val().split(o),a=[];delete u[r];e.each(u,function(t,n){n=e.trim(n);n&&a.push(n)});s.val(this.clean(a.join(o)));this.quickClicks(i);return!1},quickClicks:function(t){var n=e(".the-tags",t),r=e(".tagchecklist",t),i=e(t).attr("id"),s,o;if(!n.length)return;o=n.prop("disabled");s=n.val().split(postL10n.comma);r.empty();e.each(s,function(t,n){var s,u;n=e.trim(n);if(!n)return;s=e("<span />").text(n);if(!o){u=e('<a id="'+i+"-check-num-"+t+'" class="ntdelbutton">X</a>');u.click(function(){tagBox.parseTags(this)});s.prepend("&nbsp;").prepend(u)}r.append(s)})},flushTags:function(t,n,r){var i,s,o,u=e(".the-tags",t),a=e("input.newtag",t),f=postL10n.comma;n=n||!1;o=n?e(n).text():a.val();i=u.val();s=i?i+f+o:o;s=this.clean(s);s=array_unique_noempty(s.split(f)).join(f);u.val(s);this.quickClicks(t);n||a.val("");"undefined"==typeof r&&a.focus();return!1},get:function(t){var n=t.substr(t.indexOf("-")+1);e.post(ajaxurl,{action:"get-tagcloud",tax:n},function(r,i){if(0===r||"success"!=i)r=wpAjax.broken;r=e('<p id="tagcloud-'+n+'" class="the-tagcloud">'+r+"</p>");e("a",r).click(function(){tagBox.flushTags(e(this).closest(".inside").children(".tagsdiv"),this);return!1});e("#"+t).after(r)})},init:function(){var t=this,n=e("div.ajaxtag");e(".tagsdiv").each(function(){tagBox.quickClicks(this)});e("input.tagadd",n).click(function(){t.flushTags(e(this).closest(".tagsdiv"))});e("div.taghint",n).click(function(){e(this).css("visibility","hidden").parent().siblings(".newtag").focus()});e("input.newtag",n).blur(function(){""===this.value&&e(this).parent().siblings(".taghint").css("visibility","")}).focus(function(){e(this).parent().siblings(".taghint").css("visibility","hidden")}).keyup(function(t){if(13==t.which){tagBox.flushTags(e(this).closest(".tagsdiv"));return!1}}).keypress(function(e){if(13==e.which){e.preventDefault();return!1}}).each(function(){var t=e(this).closest("div.tagsdiv").attr("id");e(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+t,{delay:500,minchars:2,multiple:!0,multipleSep:postL10n.comma+" "})});e("#post").submit(function(){e("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})});e("a.tagcloud-link").click(function(){tagBox.get(e(this).attr("id"));e(this).unbind().click(function(){e(this).siblings(".the-tagcloud").toggle();return!1});return!1})}};commentsBox={st:0,get:function(t,n){var r=this.st,i;n||(n=20);this.st+=n;this.total=t;e("#commentsdiv .spinner").show();i={action:"get-comments",mode:"single",_ajax_nonce:e("#add_comment_nonce").val(),p:e("#post_ID").val(),start:r,number:n};e.post(ajaxurl,i,function(t){t=wpAjax.parseAjaxResponse(t);e("#commentsdiv .widefat").show();e("#commentsdiv .spinner").hide();if("object"==typeof t&&t.responses[0]){e("#the-comment-list").append(t.responses[0].data);theList=theExtraList=null;e("a[className*=':']").unbind();commentsBox.st>commentsBox.total?e("#show-comments").hide():e("#show-comments").show().children("a").html(postL10n.showcomm);return}if(1==t){e("#show-comments").html(postL10n.endcomm);return}e("#the-comment-list").append('<tr><td colspan="2">'+wpAjax.broken+"</td></tr>")});return!1}};WPSetThumbnailHTML=function(t){e(".inside","#postimagediv").html(t)};WPSetThumbnailID=function(t){var n=e('input[value="_thumbnail_id"]',"#list-table");n.size()>0&&e("#meta\\["+n.attr("id").match(/[0-9]+/)+"\\]\\[value\\]").text(t)};WPRemoveThumbnail=function(t){e.post(ajaxurl,{action:"set-post-thumbnail",post_id:e("#post_ID").val(),thumbnail_id:-1,_ajax_nonce:t,cookie:encodeURIComponent(document.cookie)},function(e){e=="0"?alert(setPostThumbnailL10n.error):WPSetThumbnailHTML(e)})};e(document).on("heartbeat-send.refresh-lock",function(t,n){var r=e("#active_post_lock").val(),i=e("#post_ID").val(),s={};if(!i||!e("#post-lock-dialog").length)return;s.post_id=i;r&&(s.lock=r);n["wp-refresh-post-lock"]=s});e(document).on("heartbeat-tick.refresh-lock",function(t,n){var r,i,s;if(n["wp-refresh-post-lock"]){r=n["wp-refresh-post-lock"];if(r.lock_error){i=e("#post-lock-dialog");if(i.length&&!i.is(":visible")){if(typeof autosave=="function"){e(document).on("autosave-disable-buttons.post-lock",function(){i.addClass("saving")}).on("autosave-enable-buttons.post-lock",function(){i.removeClass("saving").addClass("saved");window.onbeforeunload=null});autosave()||(window.onbeforeunload=null);autosave=function(){}}if(r.lock_error.avatar_src){s=e('<img class="avatar avatar-64 photo" width="64" height="64" />').attr("src",r.lock_error.avatar_src.replace(/&amp;/g,"&"));i.find("div.post-locked-avatar").empty().append(s)}i.show().find(".currently-editing").text(r.lock_error.text);i.find(".wp-tab-first").focus()}}else r.new_lock&&e("#active_post_lock").val(r.new_lock)}})})(jQuery);(function(e){function r(){t=!1;window.clearTimeout(n);n=window.setTimeout(function(){t=!0},3e5)}var t,n;e(document).on("heartbeat-send.wp-refresh-nonces",function(n,r){var i,s;t&&(s=e("#post_ID").val())&&(i=e("#_wpnonce").val())&&(r["wp-refresh-post-nonces"]={post_id:s,post_nonce:i})}).on("heartbeat-tick.wp-refresh-nonces",function(t,n){var i=n["wp-refresh-post-nonces"];if(i){r();i.replace&&e.each(i.replace,function(t,n){e("#"+t).val(n)});i.heartbeatNonce&&(window.heartbeatSettings.nonce=i.heartbeatNonce)}}).ready(function(){r()})})(jQuery);jQuery(document).ready(function(e){var t,n,r,i,s="",o=0,u=e("#content");postboxes.add_postbox_toggles(pagenow);e("#post-lock-dialog .notification-dialog").on("keydown",function(t){if(t.which!=9)return;var n=e(t.target);if(n.hasClass("wp-tab-first")&&t.shiftKey){e(this).find(".wp-tab-last").focus();t.preventDefault()}else if(n.hasClass("wp-tab-last")&&!t.shiftKey){e(this).find(".wp-tab-first").focus();t.preventDefault()}}).filter(":visible").find(".wp-tab-first").focus();typeof wp!="undefined"&&wp.heartbeat&&e("#post-lock-dialog").length&&wp.heartbeat.interval(15);e("#tagsdiv-post_tag").length?tagBox.init():e("#side-sortables, #normal-sortables, #advanced-sortables").children("div.postbox").each(function(){if(this.id.indexOf("tagsdiv-")===0){tagBox.init();return!1}});e(".categorydiv").each(function(){var t=e(this).attr("id"),n,r,i,s,o;i=t.split("-");i.shift();s=i.join("-");o=s+"_tab";s=="category"&&(o="cats");e("a","#"+s+"-tabs").click(function(){var t=e(this).attr("href");e(this).parent().addClass("tabs").siblings("li").removeClass("tabs");e("#"+s+"-tabs").siblings(".tabs-panel").hide();e(t).show();"#"+s+"-all"==t?deleteUserSetting(o):setUserSetting(o,"pop");return!1});getUserSetting(o)&&e('a[href="#'+s+'-pop"]',"#"+s+"-tabs").click();e("#new"+s).one("focus",function(){e(this).val("").removeClass("form-input-tip")});e("#new"+s).keypress(function(t){if(13===t.keyCode){t.preventDefault();e("#"+s+"-add-submit").click()}});e("#"+s+"-add-submit").click(function(){e("#new"+s).focus()});n=function(t){if(!e("#new"+s).val())return!1;t.data+="&"+e(":checked","#"+s+"checklist").serialize();e("#"+s+"-add-submit").prop("disabled",!0);return t};r=function(t,n){var r,i=e("#new"+s+"_parent");e("#"+s+"-add-submit").prop("disabled",!1);if("undefined"!=n.parsed.responses[0]&&(r=n.parsed.responses[0].supplemental.newcat_parent)){i.before(r);i.remove()}};e("#"+s+"checklist").wpList({alt:"",response:s+"-ajax-response",addBefore:n,addAfter:r});e("#"+s+"-add-toggle").click(function(){e("#"+s+"-adder").toggleClass("wp-hidden-children");e('a[href="#'+s+'-all"]',"#"+s+"-tabs").click();e("#new"+s).focus();return!1});e("#"+s+"checklist, #"+s+"checklist-pop").on("click",'li.popular-category > label input[type="checkbox"]',function(){var t=e(this),n=t.is(":checked"),r=t.val();r&&t.parents("#taxonomy-"+s).length&&e("#in-"+s+"-"+r+", #in-popular-"+s+"-"+r).prop("checked",n)})});e("#postcustom").length&&e("#the-list").wpList({addAfter:function(){e("table#list-table").show()},addBefore:function(t){t.data+="&post_id="+e("#post_ID").val();return t}});if(e("#submitdiv").length){t=e("#timestamp").html();n=e("#post-visibility-display").html();r=function(){var t=e("#post-visibility-select");if(e("input:radio:checked",t).val()!="public"){e("#sticky").prop("checked",!1);e("#sticky-span").hide()}else e("#sticky-span").show();e("input:radio:checked",t).val()!="password"?e("#password-span").hide():e("#password-span").show()};i=function(){if(!e("#timestampdiv").length)return!0;var n,r,i,s,o=e("#post_status"),u=e('option[value="publish"]',o),a=e("#aa").val(),f=e("#mm").val(),l=e("#jj").val(),c=e("#hh").val(),h=e("#mn").val();n=new Date(a,f-1,l,c,h);r=new Date(e("#hidden_aa").val(),e("#hidden_mm").val()-1,e("#hidden_jj").val(),e("#hidden_hh").val(),e("#hidden_mn").val());i=new Date(e("#cur_aa").val(),e("#cur_mm").val()-1,e("#cur_jj").val(),e("#cur_hh").val(),e("#cur_mn").val());if(n.getFullYear()!=a||1+n.getMonth()!=f||n.getDate()!=l||n.getMinutes()!=h){e(".timestamp-wrap","#timestampdiv").addClass("form-invalid");return!1}e(".timestamp-wrap","#timestampdiv").removeClass("form-invalid");if(n>i&&e("#original_post_status").val()!="future"){s=postL10n.publishOnFuture;e("#publish").val(postL10n.schedule)}else if(n<=i&&e("#original_post_status").val()!="publish"){s=postL10n.publishOn;e("#publish").val(postL10n.publish)}else{s=postL10n.publishOnPast;e("#publish").val(postL10n.update)}r.toUTCString()==n.toUTCString()?e("#timestamp").html(t):e("#timestamp").html(s+" <b>"+postL10n.dateFormat.replace("%1$s",e('option[value="'+e("#mm").val()+'"]',"#mm").text()).replace("%2$s",l).replace("%3$s",a).replace("%4$s",c).replace("%5$s",h)+"</b> ");if(e("input:radio:checked","#post-visibility-select").val()=="private"){e("#publish").val(postL10n.update);0===u.length?o.append('<option value="publish">'+postL10n.privatelyPublished+"</option>"):u.html(postL10n.privatelyPublished);e('option[value="publish"]',o).prop("selected",!0);e(".edit-post-status","#misc-publishing-actions").hide()}else{if(e("#original_post_status").val()=="future"||e("#original_post_status").val()=="draft"){if(u.length){u.remove();o.val(e("#hidden_post_status").val())}}else u.html(postL10n.published);o.is(":hidden")&&e(".edit-post-status","#misc-publishing-actions").show()}e("#post-status-display").html(e("option:selected",o).text());if(e("option:selected",o).val()=="private"||e("option:selected",o).val()=="publish")e("#save-post").hide();else{e("#save-post").show();e("option:selected",o).val()=="pending"?e("#save-post").show().val(postL10n.savePending):e("#save-post").show().val(postL10n.saveDraft)}return!0};e(".edit-visibility","#visibility").click(function(){if(e("#post-visibility-select").is(":hidden")){r();e("#post-visibility-select").slideDown("fast");e(this).hide()}return!1});e(".cancel-post-visibility","#post-visibility-select").click(function(){e("#post-visibility-select").slideUp("fast");e("#visibility-radio-"+e("#hidden-post-visibility").val()).prop("checked",!0);e("#post_password").val(e("#hidden-post-password").val());e("#sticky").prop("checked",e("#hidden-post-sticky").prop("checked"));e("#post-visibility-display").html(n);e(".edit-visibility","#visibility").show();i();return!1});e(".save-post-visibility","#post-visibility-select").click(function(){var t=e("#post-visibility-select");t.slideUp("fast");e(".edit-visibility","#visibility").show();i();e("input:radio:checked",t).val()!="public"&&e("#sticky").prop("checked",!1);e("#sticky").prop("checked")?s="Sticky":s="";e("#post-visibility-display").html(postL10n[e("input:radio:checked",t).val()+s]);return!1});e("input:radio","#post-visibility-select").change(function(){r()});e("#timestampdiv").siblings("a.edit-timestamp").click(function(){if(e("#timestampdiv").is(":hidden")){e("#timestampdiv").slideDown("fast");e("#mm").focus();e(this).hide()}return!1});e(".cancel-timestamp","#timestampdiv").click(function(){e("#timestampdiv").slideUp("fast");e("#mm").val(e("#hidden_mm").val());e("#jj").val(e("#hidden_jj").val());e("#aa").val(e("#hidden_aa").val());e("#hh").val(e("#hidden_hh").val());e("#mn").val(e("#hidden_mn").val());e("#timestampdiv").siblings("a.edit-timestamp").show();i();return!1});e(".save-timestamp","#timestampdiv").click(function(){if(i()){e("#timestampdiv").slideUp("fast");e("#timestampdiv").siblings("a.edit-timestamp").show()}return!1});e("#post").on("submit",function(t){if(!i()){t.preventDefault();e("#timestampdiv").show();e("#publishing-action .spinner").hide();e("#publish").prop("disabled",!1).removeClass("button-primary-disabled");return!1}});e("#post-status-select").siblings("a.edit-post-status").click(function(){if(e("#post-status-select").is(":hidden")){e("#post-status-select").slideDown("fast");e(this).hide()}return!1});e(".save-post-status","#post-status-select").click(function(){e("#post-status-select").slideUp("fast");e("#post-status-select").siblings("a.edit-post-status").show();i();return!1});e(".cancel-post-status","#post-status-select").click(function(){e("#post-status-select").slideUp("fast");e("#post_status").val(e("#hidden_post_status").val());e("#post-status-select").siblings("a.edit-post-status").show();i();return!1})}if(e("#edit-slug-box").length){editPermalink=function(t){var n,r,i=0,s=e("#editable-post-name"),o=s.html(),u=e("#post_name"),a=u.val(),f=e("#edit-slug-buttons"),l=f.html(),c=e("#editable-post-name-full").html();e("#view-post-btn").hide();f.html('<a href="#" class="save button button-small">'+postL10n.ok+'</a> <a class="cancel" href="#">'+postL10n.cancel+"</a>");f.children(".save").click(function(){var n=s.children("input").val();if(n==e("#editable-post-name-full").text())return e(".cancel","#edit-slug-buttons").click();e.post(ajaxurl,{action:"sample-permalink",post_id:t,new_slug:n,new_title:e("#title").val(),samplepermalinknonce:e("#samplepermalinknonce").val()},function(t){var r=e("#edit-slug-box");r.html(t);r.hasClass("hidden")&&r.fadeIn("fast",function(){r.removeClass("hidden")});f.html(l);u.val(n);makeSlugeditClickable();e("#view-post-btn").show()});return!1});e(".cancel","#edit-slug-buttons").click(function(){e("#view-post-btn").show();s.html(o);f.html(l);u.val(a);return!1});for(r=0;r<c.length;++r)"%"==c.charAt(r)&&i++;n=i>c.length/4?"":c;s.html('<input type="text" id="new-post-slug" value="'+n+'" />').children("input").keypress(function(e){var t=e.keyCode||0;if(13==t){f.children(".save").click();return!1}if(27==t){f.children(".cancel").click();return!1}}).keyup(function(){u.val(this.value)}).focus()};makeSlugeditClickable=function(){e("#editable-post-name").click(function(){e("#edit-slug-buttons").children(".edit-slug").click()})};makeSlugeditClickable()}if(typeof wpWordCount!="undefined"){e(document).triggerHandler("wpcountwords",[u.val()]);u.keyup(function(t){var n=t.keyCode||t.charCode;if(n==o)return!0;(13==n||8==o||46==o)&&e(document).triggerHandler("wpcountwords",[u.val()]);o=n;return!0})}wptitlehint=function(t){t=t||"title";var n=e("#"+t),r=e("#"+t+"-prompt-text");""===n.val()&&r.removeClass("screen-reader-text");r.click(function(){e(this).addClass("screen-reader-text");n.focus()});n.blur(function(){""===this.value&&r.removeClass("screen-reader-text")}).focus(function(){r.addClass("screen-reader-text")}).keydown(function(t){r.addClass("screen-reader-text");e(this).unbind(t)})};wptitlehint();(function(){function i(e){t.height(Math.max(50,n+e.pageY)+"px");return!1}function s(){var n;t.focus();e(document).unbind("mousemove",i).unbind("mouseup",s);n=parseInt(t.css("height"),10);n&&n>50&&n<5e3&&setUserSetting("ed_size",n)}var t=e("textarea#content"),n=null,r;if(!t.length||"ontouchstart"in window)return;t.css("resize","none");r=e('<div id="content-resize-handle"><br></div>');e("#wp-content-wrap").append(r);r.on("mousedown",function(r){n=t.height()-r.pageY;t.blur();e(document).mousemove(i).mouseup(s);return!1})})();if(typeof tinymce!="undefined"){tinymce.onAddEditor.add(function(t,n){function r(){var t,n=document.getElementById("content_ifr"),r=n?parseInt(n.style.height,10):0,i=e("#content_tbl tr.mceFirst").height();if(!r||!i)return!1;t=r+i+21;t-=33;return t}if(n.id!="content"||tinymce.isIOS5)return;n.onLoadContent.add(function(){var t,n=document.getElementById("content"),r=n?parseInt(n.style.height,10):0,i=e("#content_tbl tr.mceFirst").height()||33;if(!r||r<50||r>5e3)r=360;getUserSetting("ed_size")>5e3&&setUserSetting("ed_size",360);t=r-i+12;if(t>50&&t<5e3){e("#content_tbl").css("height","");e("#content_ifr").css("height",t+"px")}});n.onSaveContent.add(function(){var t=r();if(!t||t<50||t>5e3)return;e("textarea#content").css("height",t+"px")});n.onPostRender.add(function(){e("#content_resize").on("mousedown.wp-mce-resize",function(){e(document).on("mouseup.wp-mce-resize",function(){var t;e(document).off("mouseup.wp-mce-resize");t=r();t&&t>50&&t<5e3&&setUserSetting("ed_size",t)})})})});e("#post-formats-select input.post-format").on("change.set-editor-class",function(){var t,n,r=this.id;if(r&&e(this).prop("checked")){t=tinymce.get("content");if(t){n=t.getBody();n.className=n.className.replace(/\bpost-format-[^ ]+/,"");t.dom.addClass(n,r=="post-format-0"?"post-format-standard":r)}}})}});