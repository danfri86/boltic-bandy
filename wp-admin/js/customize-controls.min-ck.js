!function(e,t){var n=wp.customize;n.Setting=n.Value.extend({initialize:function(e,t,r){n.Value.prototype.initialize.call(this,t,r),this.id=e,this.transport=this.transport||"refresh",this.bind(this.preview)},preview:function(){switch(this.transport){case"refresh":return this.previewer.refresh();case"postMessage":return this.previewer.send("setting",[this.id,this()])}}}),n.Control=n.Class.extend({initialize:function(e,r){var i,s,o,u=this;this.params={},t.extend(this,r||{}),this.id=e,this.selector="#customize-control-"+e.replace(/\]/g,"").replace(/\[/g,"-"),this.container=t(this.selector),o=t.map(this.params.settings,function(e){return e}),n.apply(n,o.concat(function(){var e;u.settings={};for(e in u.params.settings)u.settings[e]=n(u.params.settings[e]);u.setting=u.settings["default"]||null,u.ready()})),u.elements=[],i=this.container.find("[data-customize-setting-link]"),s={},i.each(function(){var e,r=t(this);if(r.is(":radio")){if(e=r.prop("name"),s[e])return;s[e]=!0,r=i.filter('[name="'+e+'"]')}n(r.data("customizeSettingLink"),function(e){var t=new n.Element(r);u.elements.push(t),t.sync(e),t.set(e())})})},ready:function(){},dropdownInit:function(){var e=this,t=this.container.find(".dropdown-status"),n=this.params,r=!1,i=function(e){"string"==typeof e&&n.statuses&&n.statuses[e]?t.html(n.statuses[e]).show():t.hide()};this.container.on("click keydown",".dropdown",function(t){("keydown"!==t.type||13===t.which)&&(t.preventDefault(),r||e.container.toggleClass("open"),e.container.hasClass("open")&&e.container.parent().parent().find("li.library-selected").focus(),r=!0,setTimeout(function(){r=!1},400))}),this.setting.bind(i),i(this.setting())}}),n.ColorControl=n.Control.extend({ready:function(){var e=this,t=this.container.find(".color-picker-hex");t.val(e.setting()).wpColorPicker({change:function(){e.setting.set(t.wpColorPicker("color"))},clear:function(){e.setting.set(!1)}})}}),n.UploadControl=n.Control.extend({ready:function(){var e=this;this.params.removed=this.params.removed||"",this.success=t.proxy(this.success,this),this.uploader=t.extend({container:this.container,browser:this.container.find(".upload"),dropzone:this.container.find(".upload-dropzone"),success:this.success,plupload:{},params:{}},this.uploader||{}),e.params.extensions&&(e.uploader.plupload.filters=[{title:n.l10n.allowedFiles,extensions:e.params.extensions}]),e.params.context&&(e.uploader.params["post_data[context]"]=this.params.context),n.settings.theme.stylesheet&&(e.uploader.params["post_data[theme]"]=n.settings.theme.stylesheet),this.uploader=new wp.Uploader(this.uploader),this.remover=this.container.find(".remove"),this.remover.on("click keydown",function(t){("keydown"!==t.type||13===t.which)&&(e.setting.set(e.params.removed),t.preventDefault())}),this.removerVisibility=t.proxy(this.removerVisibility,this),this.setting.bind(this.removerVisibility),this.removerVisibility(this.setting.get())},success:function(e){this.setting.set(e.get("url"))},removerVisibility:function(e){this.remover.toggle(e!=this.params.removed)}}),n.ImageControl=n.UploadControl.extend({ready:function(){var e,r=this;this.uploader={init:function(){var e,t;this.supports.dragdrop||(e=r.container.find(".upload-fallback"),t=e.children().detach(),this.browser.detach().empty().append(t),e.append(this.browser).show())}},n.UploadControl.prototype.ready.call(this),this.thumbnail=this.container.find(".preview-thumbnail img"),this.thumbnailSrc=t.proxy(this.thumbnailSrc,this),this.setting.bind(this.thumbnailSrc),this.library=this.container.find(".library"),this.tabs={},e=this.library.find(".library-content"),this.library.children("ul").children("li").each(function(){var n=t(this),i=n.data("customizeTab"),s=e.filter('[data-customize-tab="'+i+'"]');r.tabs[i]={both:n.add(s),link:n,panel:s}}),this.library.children("ul").on("click keydown","li",function(e){if("keydown"!==e.type||13===e.which){var n=t(this).data("customizeTab"),i=r.tabs[n];e.preventDefault(),i.link.hasClass("library-selected")||(r.selected.both.removeClass("library-selected"),r.selected=i,r.selected.both.addClass("library-selected"))}}),this.library.on("click keydown","a",function(e){if("keydown"!==e.type||13===e.which){var n=t(this).data("customizeImageValue");n&&(r.setting.set(n),e.preventDefault())}}),this.tabs.uploaded&&(this.tabs.uploaded.target=this.library.find(".uploaded-target"),this.tabs.uploaded.panel.find(".thumbnail").length||this.tabs.uploaded.both.addClass("hidden")),e.each(function(){var e=r.tabs[t(this).data("customizeTab")];return e.link.hasClass("hidden")?void 0:(r.selected=e,e.both.addClass("library-selected"),!1)}),this.dropdownInit()},success:function(e){n.UploadControl.prototype.success.call(this,e),this.tabs.uploaded&&this.tabs.uploaded.target.length&&(this.tabs.uploaded.both.removeClass("hidden"),e.element=t('<a href="#" class="thumbnail"></a>').data("customizeImageValue",e.get("url")).append('<img src="'+e.get("url")+'" />').appendTo(this.tabs.uploaded.target))},thumbnailSrc:function(e){/^(https?:)?\/\//.test(e)?this.thumbnail.prop("src",e).show():this.thumbnail.hide()}}),n.defaultConstructor=n.Setting,n.control=new n.Values({defaultConstructor:n.Control}),n.PreviewFrame=n.Messenger.extend({sensitivity:2e3,initialize:function(e,r){var i=t.Deferred();i.promise(this),this.container=e.container,this.signature=e.signature,t.extend(e,{channel:n.PreviewFrame.uuid()}),n.Messenger.prototype.initialize.call(this,e,r),this.add("previewUrl",e.previewUrl),this.query=t.extend(e.query||{},{customize_messenger_channel:this.channel()}),this.run(i)},run:function(e){var n=this,r=!1,i=!1;this._ready&&this.unbind("ready",this._ready),this._ready=function(){i=!0,r&&e.resolveWith(n)},this.bind("ready",this._ready),this.request=t.ajax(this.previewUrl(),{type:"POST",data:this.query,xhrFields:{withCredentials:!0}}),this.request.fail(function(){e.rejectWith(n,["request failure"])}),this.request.done(function(s){var o,u=n.request.getResponseHeader("Location"),f=n.signature;return u&&u!=n.previewUrl()?(e.rejectWith(n,["redirect",u]),void 0):"0"===s?(n.login(e),void 0):"-1"===s?(e.rejectWith(n,["cheatin"]),void 0):(o=s.lastIndexOf(f),-1===o||o<s.lastIndexOf("</html>")?(e.rejectWith(n,["unsigned"]),void 0):(s=s.slice(0,o)+s.slice(o+f.length),n.iframe=t("<iframe />").appendTo(n.container),n.iframe.one("load",function(){r=!0,i?e.resolveWith(n):setTimeout(function(){e.rejectWith(n,["ready timeout"])},n.sensitivity)}),n.targetWindow(n.iframe[0].contentWindow),n.targetWindow().document.open(),n.targetWindow().document.write(s),n.targetWindow().document.close(),void 0))})},login:function(e){var r,i=this;return r=function(){e.rejectWith(i,["logged out"])},this.triedLogin?r():(t.get(n.settings.url.ajax,{action:"logged-in"}).fail(r).done(function(n){var s;"1"!==n&&r(),s=t('<iframe src="'+i.previewUrl()+'" />').hide(),s.appendTo(i.container),s.load(function(){i.triedLogin=!0,s.remove(),i.run(e)})}),void 0)},destroy:function(){n.Messenger.prototype.destroy.call(this),this.request.abort(),this.iframe&&this.iframe.remove(),delete this.request,delete this.iframe,delete this.targetWindow}}),function(){var e=0;n.PreviewFrame.uuid=function(){return"preview-"+e++}}(),n.Previewer=n.Messenger.extend({refreshBuffer:250,initialize:function(e,r){var i=this,s=/^https?/;t.extend(this,r||{}),this.refresh=function(e){var t,n=e.refresh,r=function(){t=null,n.call(e)};return function(){if("number"!=typeof t){if(!e.loading)return r();e.abort()}clearTimeout(t),t=setTimeout(r,e.refreshBuffer)}}(this),this.container=n.ensure(e.container),this.allowedUrls=e.allowedUrls,this.signature=e.signature,e.url=window.location.href,n.Messenger.prototype.initialize.call(this,e),this.add("scheme",this.origin()).link(this.origin).setter(function(e){var t=e.match(s);return t?t[0]:""}),this.add("previewUrl",e.previewUrl).setter(function(e){var n;return/\/wp-admin(\/|$)/.test(e.replace(/[#?].*$/,""))?null:(t.each([e.replace(s,i.scheme()),e],function(e,r){return t.each(i.allowedUrls,function(e,t){var i;return t=t.replace(/\/+$/,""),i=r.replace(t,""),0===r.indexOf(t)&&/^([/#?]|$)/.test(i)?(n=r,!1):void 0}),n?!1:void 0}),n?n:null)}),this.previewUrl.bind(this.refresh),this.scroll=0,this.bind("scroll",function(e){this.scroll=e}),this.bind("url",this.previewUrl)},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var e=this;this.abort(),this.loading=new n.PreviewFrame({url:this.url(),previewUrl:this.previewUrl(),query:this.query()||{},container:this.container,signature:this.signature}),this.loading.done(function(){this.bind("synced",function(){e.preview&&e.preview.destroy(),e.preview=this,delete e.loading,e.targetWindow(this.targetWindow()),e.channel(this.channel()),e.send("active")}),this.send("sync",{scroll:e.scroll,settings:n.get()})}),this.loading.fail(function(t,n){"redirect"===t&&n&&e.previewUrl(n),"logged out"===t&&(e.preview&&(e.preview.destroy(),delete e.preview),e.login().done(e.refresh)),"cheatin"===t&&e.cheatin()})},login:function(){var e,r,i,s=this;return this._login?this._login:(e=t.Deferred(),this._login=e.promise(),r=new n.Messenger({channel:"login",url:n.settings.url.login}),i=t('<iframe src="'+n.settings.url.login+'" />').appendTo(this.container),r.targetWindow(i[0].contentWindow),r.bind("login",function(){i.remove(),r.destroy(),delete s._login,e.resolve()}),this._login)},cheatin:function(){t(document.body).empty().addClass("cheatin").append("<p>"+n.l10n.cheatin+"</p>")}}),n.controlConstructor={color:n.ColorControl,upload:n.UploadControl,image:n.ImageControl},t(function(){if(n.settings=window._wpCustomizeSettings,n.l10n=window._wpCustomizeControlsL10n,n.settings){if(!t.support.postMessage||!t.support.cors&&n.settings.isCrossDomain)return window.location=n.settings.url.fallback;var e,r,i,s=t(document.body),o=s.children(".wp-full-overlay");t("#customize-controls").on("keydown",function(e){t(e.target).is("textarea")||13===e.which&&e.preventDefault()}),e=new n.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:n.settings.url.preview,allowedUrls:n.settings.url.allowed,signature:"WP_CUSTOMIZER_SIGNATURE"},{nonce:n.settings.nonce,query:function(){return{wp_customize:"on",theme:n.settings.theme.stylesheet,customized:JSON.stringify(n.get()),nonce:this.nonce.preview}},save:function(){var e=this,r=t.extend(this.query(),{action:"customize_save",nonce:this.nonce.save}),i=t.post(n.settings.url.ajax,r);n.trigger("save",i),s.addClass("saving"),i.always(function(){s.removeClass("saving")}),i.done(function(t){return"0"===t?(e.preview.iframe.hide(),e.login().done(function(){e.save(),e.preview.iframe.show()}),void 0):"-1"===t?(e.cheatin(),void 0):(n.trigger("saved"),void 0)})}}),e.bind("nonce",function(e){t.extend(this.nonce,e)}),t.each(n.settings.settings,function(t,r){n.create(t,t,r.value,{transport:r.transport,previewer:e})}),t.each(n.settings.controls,function(t,r){var i,s=n.controlConstructor[r.type]||n.Control;i=n.control.add(t,new s(t,{params:r,previewer:e}))}),e.previewUrl()?e.refresh():e.previewUrl(n.settings.url.home),function(){var e=new n.Values,r=e.create("saved"),i=e.create("activated");e.bind("change",function(){var e=t("#save"),s=t(".back");i()?r()?(e.val(n.l10n.saved).prop("disabled",!0),s.text(n.l10n.close)):(e.val(n.l10n.save).prop("disabled",!1),s.text(n.l10n.cancel)):(e.val(n.l10n.activate).prop("disabled",!1),s.text(n.l10n.cancel))}),r(!0),i(n.settings.theme.active),n.bind("change",function(){e("saved").set(!1)}),n.bind("saved",function(){e("saved").set(!0),e("activated").set(!0)}),i.bind(function(e){e&&n.trigger("activated")}),n.state=e}(),t("#save").click(function(t){e.save(),t.preventDefault()}).keydown(function(t){9!==t.which&&(13===t.which&&e.save(),t.preventDefault())}),t(".back").keydown(function(e){9!==e.which&&(13===e.which&&this.click(),e.preventDefault())}),t(".upload-dropzone a.upload").keydown(function(e){13===e.which&&this.click()}),t(".collapse-sidebar").on("click keydown",function(e){("keydown"!==e.type||13===e.which)&&(o.toggleClass("collapsed").toggleClass("expanded"),e.preventDefault())}),r=new n.Messenger({url:n.settings.url.parent,channel:"loader"}),r.bind("back",function(){t(".back").on("click.back",function(e){e.preventDefault(),r.send("close")})}),n.bind("saved",function(){r.send("saved")}),n.bind("activated",function(){r.targetWindow()?r.send("activated",n.settings.url.activated):n.settings.url.activated&&(window.location=n.settings.url.activated)}),r.send("ready"),t.each({background_image:{controls:["background_repeat","background_position_x","background_attachment"],callback:function(e){return!!e}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(e){return"page"===e}},header_textcolor:{controls:["header_textcolor"],callback:function(e){return"blank"!==e}}},function(e,r){n(e,function(e){t.each(r.controls,function(t,i){n.control(i,function(t){var n=function(e){t.container.toggle(r.callback(e))};n(e.get()),e.bind(n)})})})}),n.control("display_header_text",function(e){var t="";e.elements[0].unsync(n("header_textcolor")),e.element=new n.Element(e.container.find("input")),e.element.set("blank"!==e.setting()),e.element.bind(function(r){r||(t=n("header_textcolor").get()),e.setting.set(r?t:"blank")}),e.setting.bind(function(t){e.element.set("blank"!==t)})}),n.control("header_image",function(e){e.setting.bind(function(t){t===e.params.removed&&e.settings.data.set(!1)}),e.library.on("click","a",function(){e.settings.data.set(t(this).data("customizeHeaderImageData"))}),e.uploader.success=function(t){var r;n.ImageControl.prototype.success.call(e,t),r={attachment_id:t.get("id"),url:t.get("url"),thumbnail_url:t.get("url"),height:t.get("height"),width:t.get("width")},t.element.data("customizeHeaderImageData",r),e.settings.data.set(r)}}),n.trigger("ready"),i=t(".back"),i.focus(),setTimeout(function(){i.focus()},200)}})}(wp,jQuery);