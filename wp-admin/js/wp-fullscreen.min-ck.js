var PubSub,fullscreen,wptitlehint;PubSub=function(){this.topics={}},PubSub.prototype.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},PubSub.prototype.unsubscribe=function(e,t){var n,r,i=this.topics[e];if(!i)return t||[];if(t){for(n=0,r=i.length;r>n;n++)t==i[n]&&i.splice(n,1);return t}return this.topics[e]=[],i},PubSub.prototype.publish=function(e,t){var n,r,i,s=this.topics[e];if(s){for(t=t||[],n=0,r=s.length;r>n;n++)i=s[n].apply(null,t)===!1||i;return!i}},function(e){var t,n,r,i,s,o,u;fullscreen=t={},n=t.pubsub=new PubSub,s=0,o=!1,i=t.settings={visible:!1,mode:"tinymce",editor_id:"content",title_id:"",timer:0,toolbar_shown:!1},r=t.bounder=function(t,r,s,u){function f(){n.publish(r),i.timer=0}var l,h;s=s||1250,u&&(l=u.pageY||u.clientY||u.offsetY,h=e(document).scrollTop(),u.isDefaultPrevented||(l=135+l),l-h>120)||o||(o=!0,setTimeout(function(){o=!1},400),i.timer?clearTimeout(i.timer):n.publish(t),i.timer=setTimeout(f,s))},t.on=function(){i.visible||("object"==typeof wp_fullscreen_settings&&e.extend(i,wp_fullscreen_settings),i.editor_id=wpActiveEditor||"content",e("input#title").length&&"content"==i.editor_id?i.title_id="title":e("input#"+i.editor_id+"-title").length?i.title_id=i.editor_id+"-title":e("#wp-fullscreen-title, #wp-fullscreen-title-prompt-text").hide(),i.mode=e("#"+i.editor_id).is(":hidden")?"tinymce":"html",i.qt_canvas=e("#"+i.editor_id).get(0),i.element||t.ui.init(),i.is_mce_on=i.has_tinymce&&"undefined"!=typeof tinymce.get(i.editor_id),t.ui.fade("show","showing","shown"))},t.off=function(){i.visible&&t.ui.fade("hide","hiding","hidden")},t.switchmode=function(e){var t=i.mode;return e&&i.visible&&i.has_tinymce?t==e?t:(n.publish("switchMode",[t,e]),i.mode=e,n.publish("switchedMode",[t,e]),e):t},t.save=function(){var n=e("#hiddenaction"),r=n.val(),i=e("#wp-fullscreen-save .spinner"),s=e("#wp-fullscreen-save span");i.show(),t.savecontent(),n.val("wp-fullscreen-save-post"),e.post(ajaxurl,e("form#post").serialize(),function(t){i.hide(),s.show(),setTimeout(function(){s.fadeOut(1e3)},3e3),t.last_edited&&e("#wp-fullscreen-save input").attr("title",t.last_edited)},"json"),n.val(r)},t.savecontent=function(){var t,n;i.title_id&&e("#"+i.title_id).val(e("#wp-fullscreen-title").val()),n="tinymce"===i.mode&&(t=tinymce.get("wp_mce_fullscreen"))?t.save():e("#wp_mce_fullscreen").val(),e("#"+i.editor_id).val(n),e(document).triggerHandler("wpcountwords",[n])},u=function(e){e.val().length?e.siblings("label").css("visibility","hidden"):e.siblings("label").css("visibility","")},t.dfw_width=function(t){var n=e("#wp-fullscreen-wrap"),r=n.width();return t?(r=t+r,200>r||r>1200||(n.width(r),setUserSetting("dfw_width",r)),void 0):(n.width(e("#wp-fullscreen-central-toolbar").width()),deleteUserSetting("dfw_width"),void 0)},n.subscribe("showToolbar",function(){i.toolbars.removeClass("fade-1000").addClass("fade-300"),t.fade.In(i.toolbars,300,function(){n.publish("toolbarShown")},!0),e("#wp-fullscreen-body").addClass("wp-fullscreen-focus"),i.toolbar_shown=!0}),n.subscribe("hideToolbar",function(){i.toolbars.removeClass("fade-300").addClass("fade-1000"),t.fade.Out(i.toolbars,1e3,function(){n.publish("toolbarHidden")},!0),e("#wp-fullscreen-body").removeClass("wp-fullscreen-focus")}),n.subscribe("toolbarShown",function(){i.toolbars.removeClass("fade-300")}),n.subscribe("toolbarHidden",function(){i.toolbars.removeClass("fade-1000"),i.toolbar_shown=!1}),n.subscribe("show",function(){var t;i.title_id&&(t=e("#wp-fullscreen-title").val(e("#"+i.title_id).val()),u(t)),e("#wp-fullscreen-save input").attr("title",e("#last-edit").text()),i.textarea_obj.value=i.qt_canvas.value,i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("wpFullScreenInit"),i.orig_y=e(window).scrollTop()}),n.subscribe("showing",function(){e(document.body).addClass("fullscreen-active"),t.refresh_buttons(),e(document).bind("mousemove.fullscreen",function(e){r("showToolbar","hideToolbar",2e3,e)}),r("showToolbar","hideToolbar",2e3),t.bind_resize(),setTimeout(t.resize_textarea,200),scrollTo(0,0),e("#wpadminbar").hide()}),n.subscribe("shown",function(){var e;i.visible=!0,i.has_tinymce&&!i.is_mce_on&&(e=function(t,n){var r=n.getElement(),s=r.value,o=tinyMCEPreInit.mceInit[i.editor_id];o&&o.wpautop&&"undefined"!=typeof switchEditors&&(r.value=switchEditors.wpautop(r.value)),n.onInit.add(function(t){t.hide(),t.getElement().value=s,tinymce.onAddEditor.remove(e)})},tinymce.onAddEditor.add(e),tinymce.init(tinyMCEPreInit.mceInit[i.editor_id]),i.is_mce_on=!0),wpActiveEditor="wp_mce_fullscreen"}),n.subscribe("hide",function(){var n=e("#"+i.editor_id).is(":hidden");i.has_tinymce&&"tinymce"===i.mode&&!n?switchEditors.go(i.editor_id,"tmce"):"html"===i.mode&&n&&switchEditors.go(i.editor_id,"html"),t.savecontent(),e(document).unbind(".fullscreen"),e(i.textarea_obj).unbind(".grow"),i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("wpFullScreenSave"),i.title_id&&u(e("#"+i.title_id)),i.qt_canvas.value=i.textarea_obj.value}),n.subscribe("hiding",function(){e(document.body).removeClass("fullscreen-active"),scrollTo(0,i.orig_y),e("#wpadminbar").show()}),n.subscribe("hidden",function(){i.visible=!1,e("#wp_mce_fullscreen, #wp-fullscreen-title").removeAttr("style"),i.has_tinymce&&i.is_mce_on&&tinymce.execCommand("wpFullScreenClose"),i.textarea_obj.value="",t.oldheight=0,wpActiveEditor=i.editor_id}),n.subscribe("switchMode",function(e,t){var n;i.has_tinymce&&i.is_mce_on&&(n=tinymce.get("wp_mce_fullscreen"),"html"===e&&"tinymce"===t?(tinymce.get(i.editor_id).getParam("wpautop")&&"undefined"!=typeof switchEditors&&(i.textarea_obj.value=switchEditors.wpautop(i.textarea_obj.value)),"undefined"==typeof n?tinymce.execCommand("wpFullScreenInit"):n.show()):"tinymce"===e&&"html"===t&&n&&n.hide())}),n.subscribe("switchedMode",function(e,n){t.refresh_buttons(!0),"html"===n&&setTimeout(t.resize_textarea,200)}),t.b=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("Bold")},t.i=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("Italic")},t.ul=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("InsertUnorderedList")},t.ol=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("InsertOrderedList")},t.link=function(){i.has_tinymce&&"tinymce"===i.mode?tinymce.execCommand("WP_Link"):wpLink.open()},t.unlink=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("unlink")},t.atd=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("mceWritingImprovementTool")},t.help=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("WP_Help")},t.blockquote=function(){i.has_tinymce&&"tinymce"===i.mode&&tinymce.execCommand("mceBlockQuote")},t.medialib=function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(i.editor_id)},t.refresh_buttons=function(t){t=t||!1,"html"===i.mode?(e("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).addClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===i.mode&&(e("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).removeClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},t.ui={init:function(){var n=e("#fullscreen-topbar"),s=e("#wp_mce_fullscreen"),o=0;i.toolbars=n.add(e("#wp-fullscreen-status")),i.element=e("#fullscreen-fader"),i.textarea_obj=s[0],i.has_tinymce="undefined"!=typeof tinymce,i.has_tinymce||e("#wp-fullscreen-mode-bar").hide(),wptitlehint&&e("#wp-fullscreen-title").length&&wptitlehint("wp-fullscreen-title"),e(document).keyup(function(n){var r,i,s=n.keyCode||n.charCode;return fullscreen.settings.visible?(r=navigator.platform&&-1!=navigator.platform.indexOf("Mac")?n.ctrlKey:n.altKey,27==s&&(i={event:n,what:"dfw",cb:fullscreen.off,condition:function(){return e("#TB_window").is(":visible")||e(".wp-dialog").is(":visible")?!1:!0}},jQuery(document).triggerHandler("wp_CloseOnEscape",[i])||fullscreen.off()),!r||61!=s&&107!=s&&187!=s||(t.dfw_width(25),n.preventDefault()),!r||45!=s&&109!=s&&189!=s||(t.dfw_width(-25),n.preventDefault()),r&&48==s&&(t.dfw_width(0),n.preventDefault()),void 0):!0}),"undefined"!=typeof wpWordCount&&s.keyup(function(t){var n=t.keyCode||t.charCode;return n==o?!0:((13==n||8==o||46==o)&&e(document).triggerHandler("wpcountwords",[s.val()]),o=n,!0)}),n.mouseenter(function(){i.toolbars.addClass("fullscreen-make-sticky"),e(document).unbind(".fullscreen"),clearTimeout(i.timer),i.timer=0}).mouseleave(function(){i.toolbars.removeClass("fullscreen-make-sticky"),i.visible&&e(document).bind("mousemove.fullscreen",function(e){r("showToolbar","hideToolbar",2e3,e)})})},fade:function(e,r,s){i.element||t.ui.init(),(!e||n.publish(e))&&t.fade.In(i.element,600,function(){r&&n.publish(r),t.fade.Out(i.element,600,function(){s&&n.publish(s)})})}},t.fade={transitionend:"transitionend webkitTransitionEnd oTransitionEnd",sensitivity:100,In:function(n,r,i,s){if(i=i||e.noop,r=r||400,s=s||!1,t.fade.transitions){if(n.is(":visible"))return n.addClass("fade-trigger"),n;n.show(),n.first().one(this.transitionend,function(){i()}),setTimeout(function(){n.addClass("fade-trigger")},this.sensitivity)}else s&&n.stop(),n.css("opacity",1),n.first().fadeIn(r,i),n.length>1&&n.not(":first").fadeIn(r);return n},Out:function(n,r,i,s){return i=i||e.noop,r=r||400,s=s||!1,n.is(":visible")?(t.fade.transitions?(n.first().one(t.fade.transitionend,function(){n.hasClass("fade-trigger")||(n.hide(),i())}),setTimeout(function(){n.removeClass("fade-trigger")},this.sensitivity)):(s&&n.stop(),n.first().fadeOut(r,i),n.length>1&&n.not(":first").fadeOut(r)),n):n},transitions:function(){var e=document.documentElement.style;return"string"==typeof e.WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition}()},t.bind_resize=function(){e(i.textarea_obj).bind("keypress.grow click.grow paste.grow",function(){setTimeout(t.resize_textarea,200)})},t.oldheight=0,t.resize_textarea=function(){var e,n=i.textarea_obj;e=n.scrollHeight>300?n.scrollHeight:300,e!=t.oldheight&&(n.style.height=e+"px",t.oldheight=e)}}(jQuery);