var gresultsAjaxRequest,gresults={drawCharts:function(){var e=jQuery(".gresults-chart-wrapper");e.each(function(e,t){var n=jQuery(t).attr("id"),r=jQuery(t).data("options"),i=jQuery(t).data("datatable"),s=jQuery(t).data("charttype"),o=i,u=google.visualization.arrayToDataTable(o),a=document.getElementById(n),f;s=="bar"?f=new google.visualization.BarChart(a):s=="pie"?f=new google.visualization.PieChart(a):s=="column"&&(f=new google.visualization.ColumnChart(a));f.draw(u,r)})},renderStateData:function(e){jQuery("#gresults-results").data("searchcriteria",e.searchCriteria);jQuery("#gresults-results-filter").html(e.filterUI);jQuery("#gresults-results").css("opacity",0);jQuery("#gresults-results").html(e.html);gresults.drawCharts();jQuery("#gresults-results").fadeTo("slow",1);var t=jQuery("#gresults-results-field-filters-container");t.resizable();t.resizable("destroy");t.resizable({handles:"s"})},getResults:function(){gresults.recordFormState();var e=jQuery("#gresults-results-filter-form").serialize();gresults.sendRequest(e)},sendRequest:function(e,t,n){var r=jQuery("#gresults-results"),i=jQuery("#gresults-results-filter-buttons input"),s=jQuery(".gresults-filter-loading"),o=jQuery("#gresults-view-slug").val(),u="action=gresults_get_results_"+o+"&"+e;t&&(u+="&state="+t+"&checkSum="+n);gresultsAjaxRequest=jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:u,beforeSend:function(e,t){r.fadeTo("slow",.33);r.html("");s.show();i.attr("disabled","disabled")}}).done(function(n){if(n!==-1)if(n.status==="complete"){i.removeAttr("disabled");s.hide();r.html(n.html);jQuery("#gresults-results").data("searchcriteria",n.searchCriteria);var o=jQuery("#gresults-results-filter").html();gresults.drawCharts();r.fadeTo("slow",1);window.history.replaceState&&(history.state?history.pushState({html:n.html,filterUI:o,searchCriteria:n.searchCriteria},"","?"+e):history.replaceState({html:n.html,filterUI:o,searchCriteria:n.searchCriteria},"","?"+e));gresults.drawCharts();window.gform_initialize_tooltips&&gform_initialize_tooltips()}else if(n.status==="incomplete"){t=n.stateObject;gresults.sendRequest(e,t,n.checkSum);r.html(n.html)}else{s.hide();r.html(gresultsStrings.ajaxError)}}).fail(function(e){i.removeAttr("disabled");r.fadeTo("fast",1);var t=e.statusText;s.hide();t=="abort"?t="Request cancelled":t=gresultsStrings.ajaxError;r.html(t)})},getMoreResults:function(e,t){var n=jQuery("#gresults-results-field-content-"+t),r=jQuery("#gresults-results"),i=jQuery(n).data("offset"),s=jQuery("#gresults-view-slug").val(),o=jQuery("#gresults-results").data("searchcriteria");jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"gresults_get_more_results_"+s,view:s,form_id:e,field_id:t,offset:i,search_criteria:o},success:function(e){if(e!==-1){e.html&&jQuery(n).append(e.html);e.remaining<=0&&jQuery("#gresults-results-field-more-link-"+t).hide();jQuery(n).data("offset",i+10)}}});return!1},setUpFilter:function(){var e,t,n,r;gresultsVars.filterFields.length==0&&gresults.displayNoFieldsMessage();for(var e=0;e<gresultsVars.filterFields.length;e++)jQuery("#gresults-results-field-filters").append(gresults.getNewFilterRow());jQuery(".gresults-filter-field").each(function(e){var t=gresultsVars.filterFields[e];jQuery(this).val(t);jQuery(this).change()});jQuery(".gresults-filter-operator").each(function(e){var t=gresultsVars.filterOperators[e];jQuery(this).val(t);jQuery(this).change()});jQuery(".gresults-filter-value").each(function(e){var t=gresultsVars.filterValues[e];jQuery(this).val(t);jQuery(this).change()});gresults.maybeMakeResizable()},clearFilterForm:function(){gresults.displayNoFieldsMessage();jQuery("#gresults-results-filter-form").find("input, select").each(function(){switch(this.type){case"text":case"select-one":jQuery(this).val("").change();break;case"checkbox":case"radio":this.checked=!1}})},recordFormState:function(){jQuery("#gresults-results-filter-form input[type='radio']").each(function(){this.checked?jQuery(this).prop("defaultChecked",!0):jQuery(this).prop("defaultChecked",!1)});jQuery("#gresults-results-filter-form input[type='checkbox']").each(function(){this.checked?jQuery(this).prop("defaultChecked",!0):jQuery(this).prop("defaultChecked",!1)});jQuery("#gresults-results-filter-form input[type='text']").each(function(){jQuery(this).prop("defaultValue",jQuery(this).val())});jQuery("#gresults-results-filter-form select option").each(function(){jQuery(this).prop("defaultSelected",jQuery(this).prop("selected"))})},getNewFilterRow:function(){var e;e="<div class='gresults-results-field-filter'>";e+=gresults.getFilterFields()+gresults.getFilterOperators()+gresults.getFilterValues()+gresults.getAddRemoveButtons();e+="</div>";return e},getFilterFields:function(){var e,t,n,r,i,s,o="",u="",a,f,l="<select class='gresults-filter-field' name='f[]' onchange='gresults.changeField(this)'>";for(e=0;e<gresultsFilters.length;e++){n=gresultsFilters[e].key;if(gresultsFilters[e].type=="group"){s=gresultsFilters[e].text;f=gresultsFilters[e].filters.length;for(t=0;t<f;t++){i=gresultsFilters[e].filters[t].text;r=gresultsFilters[e].filters[t].key;u=gresults.isFieldSelected(r)?'disabled="disabled"':"";o+="<option "+u+' value="'+r+'">'+i+"</option>"}l+='<optgroup label="'+s+'">'+o+"</optgroup>"}else{u=gresultsFilters[e].preventMultiple&&gresults.isFieldSelected(n)?"disabled='disabled'":"";i=gresultsFilters[e].text;l+="<option "+u+' value="'+n+'">'+i+"</option>"}}l+="</select>";l+="<input type='hidden' class='gresults-filter-type' name='t[]' value='' >";return l},changeField:function(e){var t=gresults.getFilter(e.value);if(t){jQuery(e).siblings(".gresults-filter-value").replaceWith(gresults.getFilterValues(t));jQuery(e).siblings(".gresults-filter-type").val(t.type);jQuery(e).siblings(".gresults-filter-operator").replaceWith(gresults.getFilterOperators(t))}gresults.setDisabledFields()},isFieldSelected:function(e){e=e.toString();var t=[];jQuery(".gresults-filter-field :selected").each(function(e,n){t[e]=jQuery(n).val()});return jQuery.inArray(e,t)>-1?!0:!1},getFilterOperators:function(e){var t="<select name='o[]' class='gresults-filter-operator'>",n;if(e)for(i=0;i<e.operators.length;i++){n=e.operators[i];t+="<option value='"+n+"'>"+gresultsOperatorStrings[n]+"</option>"}t+="</select>";return t},getFilterValues:function(e){var t,n,r,i,s="";i="<input type='text' value='' name='v[]' class='gresults-filter-value' />";if(e&&e.values){for(t=0;t<e.values.length;t++){n=e.values[t].value;r=e.values[t].text;s+="<option value='"+n+"'>"+r+"</option>"}i="<select name='v[]' class='gresults-filter-value'>"+s+"</select>"}return i},cleanFieldId:function(e){if(e.indexOf("-")!==-1){var t=e.split("-");e=t[0]}return e},getFilter:function(e){if(!e)return;for(var t=0;t<gresultsFilters.length;t++){if(e==gresultsFilters[t].key)return gresultsFilters[t];if(gresultsFilters[t].type=="group")for(var n=0;n<gresultsFilters[t].filters.length;n++)if(e==gresultsFilters[t].filters[n].key)return gresultsFilters[t].filters[n]}},getFieldIndex:function(e){for(var t=0;t<gresultsFields.length;t++)if(gresultsFields[t].id==e)return t},getAddRemoveButtons:function(){var e="";e+="<img class='gresults-add' onclick='gresults.addNewFieldFilter(this)' src='"+gresultsVars.imagesUrl+"/add.png' alt='"+gresultsStrings.addFieldFilter+"' title='"+gresultsStrings.addFieldFilter+"'>";e+="<img class='gresults-remove' onclick='gresults.removeFieldFilter(this)' src='"+gresultsVars.imagesUrl+"/remove.png' alt='"+gresultsStrings.removeFieldFilter+"' title='"+gresultsStrings.removeFieldFilter+"'>";return e},addNewFieldFilter:function(e){jQuery(e).parent().after(gresults.getNewFilterRow());jQuery(e).parent().next("div").find(".gresults-filter-field").change();gresults.maybeMakeResizable()},maybeMakeResizable:function(){var e=jQuery("#gresults-results-field-filters"),t=jQuery(".gresults-results-field-filter"),n=jQuery("#gresults-results-field-filters-container");if(t.length<=1){jQuery(n).hasClass("ui-resizable")&&n.resizable("destroy");return}var r=e.get(0).scrollHeight>n.height()||n.height()>=120;n.toggleClass("resizable",r);if(r){n.resizable({handles:"s",minHeight:120});e.css("min-height",120)}},removeFieldFilter:function(e){jQuery(e).parent().remove();jQuery(".gresults-results-field-filter").length==0&&gresults.displayNoFieldsMessage();gresults.setDisabledFields();gresults.maybeMakeResizable()},displayNoFieldsMessage:function(){var e="";e+="<div id='gresults-no-filters'>"+gresultsStrings.noFilters;e+="<img class='gresults-add' onclick='gresults.addNewFieldFilter(this);jQuery(this).parent().remove();' src='"+gresultsVars.imagesUrl+"/add.png' alt='"+gresultsStrings.addFieldFilter+"' title='"+gresultsStrings.addFieldFilter+"'></div>";jQuery("#gresults-results-field-filters").html(e);jQuery("#gresults-results-field-filters-container").removeClass("resizable");jQuery("#gresults-results-field-filters-container").height(55);jQuery("#gresults-results-field-filters").css("min-height","")},setDisabledFields:function(){jQuery("select.gresults-filter-field option").removeAttr("disabled");jQuery("select.gresults-filter-field").each(function(e){var t=gresults.getFilter(this.value);typeof t!="undefined"&&t.preventMultiple&&gresults.isFieldSelected(this.value)&&jQuery("select.gresults-filter-field option[value='"+this.value+"']:not(:selected)").attr("disabled","disabled")})},getFieldType:function(e){for(var t=0;t<gresultsFields.length;t++)if(gresultsFields[t].id==e)return gresultsFields[t].inputType}};google.load("visualization","1",{packages:["corechart"]});google.setOnLoadCallback(gresults.drawCharts);jQuery(document).ready(function(){if(jQuery("#gresults-results").length>0){var e=jQuery(window),t=jQuery("#gresults-results-filter"),n=t.offset().top,r,i=jQuery("#gresults-results"),s=20,o,u;function a(){o=i.width()+i.offset().left+s;t.offset({left:o});u=i.width()+s;jQuery("#gresults-results-filter").css("visibility","visible")}e.scroll(function(i){var s=e.scrollTop()>n-30;if(r!=s){r=s;r?t.css("left",o):t.css("left",u)}t.toggleClass("sticky",r)});window.onpopstate=function(e){e.state&&gresults.renderStateData(e.state)};e.resize(function(e){if(e.target===window){a();gresults.drawCharts()}});a();gresults.setUpFilter();jQuery("#gresults-results-filter-date-start, #gresults-results-filter-date-end").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0});jQuery("#gresults-results-filter-form").submit(function(e){gresults.getResults();return!1});history.state?gresults.renderStateData(history.state):gresults.getResults();window.gform_initialize_tooltips&&gform_initialize_tooltips()}});