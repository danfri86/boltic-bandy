/**
* Confirmation Editor
*
* Primarily hosts the confirmationEditor() object.
*
*/function confirmationEditor(e){this._form=e;this._hasUnsavedChanges=!1;this._loaded=!1;this._editing=!1;this._editor=jQuery("#confirmation-editor");this._editorRow=this._editor.parents("tr");this._saveButton=this._editor.find("a#save-button");this._cancelLink=this._editor.find("a#cancel-link");this._updateMessage=this._editor.find("#update-message");this._labels={save:gf_vars.confirmationSave,saving:gf_vars.confirmationSaving,areYouSure:gf_vars.confirmationAreYouSure,issueSaving:gf_vars.confirmationIssueSaving,confirmDelete:gf_vars.confirmationConfirmDelete,issueDeleting:gf_vars.confirmationIssueDeleting,confirmDiscard:gf_vars.confirmationConfirmDiscard,defaultName:gf_vars.confirmationDefaultName,defaultMessage:gf_vars.confirmationDefaultMessage};this._tempConf=[];this.confirmations=e.confirmations;this.init=function(){var e=this;jQuery(document).on("change",this._editor.find("input, textarea, select"),function(){e._hasUnsavedChanges=!0})};this.toggleConfirmation=function(e){var t=jQuery("#form_confirmation_redirect").is(":checked"),n=jQuery("#form_confirmation_show_page").is(":checked");if(t){show_element="#form_confirmation_redirect_container";hide_element="#form_confirmation_message_container, #form_confirmation_page_container";jQuery("#form_confirmation_message").val("");jQuery("#form_disable_autoformatting").prop("checked",!1);jQuery("#form_confirmation_page").val("")}else if(n){show_element="#form_confirmation_page_container";hide_element="#form_confirmation_message_container, #form_confirmation_redirect_container";jQuery("#form_confirmation_message").val("");jQuery("#form_disable_autoformatting").prop("checked",!1);jQuery("#form_confirmation_page").val("");jQuery("#form_confirmation_url").val("");jQuery("#form_redirect_querystring").val("");jQuery("#form_redirect_use_querystring").prop("checked",!1)}else{show_element="#form_confirmation_message_container";hide_element="#form_confirmation_page_container, #form_confirmation_redirect_container";jQuery("#form_confirmation_page").val("");jQuery("#form_confirmation_url").val("");jQuery("#form_redirect_querystring").val("");jQuery("#form_redirect_use_querystring").prop("checked",!1)}var r=e?"":"slow";jQuery(hide_element).hide(r);jQuery(show_element).show(r)};this.toggleQueryString=function(e){var t=e?"":"slow";if(jQuery("#form_redirect_use_querystring").is(":checked"))jQuery("#form_redirect_querystring_container").show(t);else{jQuery("#form_redirect_querystring_container").hide(t);jQuery("#form_redirect_querystring").val("");jQuery("#form_redirect_use_querystring").val("")}};this.cancelEdit=function(e){var t=this;if(t._hasUnsavedChanges&&!confirm(t._labels.areYouSure))return;location.href=e};this.save=function(){var t=this,n=gfAjaxSpinner(jQuery("#save-button"),gf_vars.baseUrl+"/images/spinner.gif"),r=this.getConfirmationFromUI(),i=r.id=="new";switch(r.type){case"page":if(r.pageId.length<1){alert(gf_vars.confirmationInvalidPageSelection);n.destroy();return!1}break;case"redirect":if(r.url.length<1){alert(gf_vars.confirmationInvalidRedirect);n.destroy();return!1}}if(this.isDefaultConfirmation(r.id))r.isDefault=1;else if(r.name.length<1){alert(gf_vars.confirmationInvalidName);n.destroy();return!1}this._saveButton.text(this._labels.saving);this._cancelLink.hide();jQuery.post(ajaxurl,{form_id:e.id,confirmation:r,action:"gf_save_confirmation",gf_save_confirmation:gf_save_confirmation},function(e){n.destroy();if(!e){t._saveButton.text(t._labels.save);t._cancelLink.show();alert(t._labels.issueSaving);return}var r=jQuery.parseJSON(e),s=r.confObj,o=r.data;if(i){var u=jQuery("tr#confirmation-new");u.attr("id","confirmation-"+s.id)}t.confirmations[s.id]=s;t._hasUnsavedChanges=!1;t._saveButton.text(t._labels.save);t._cancelLink.show();t._updateMessage.show();setTimeout("jQuery('#update-message').hide('slow');",4e3)})};this.confirmAndDelete=function(e,t){if(!confirm(this._labels.confirmDelete)||this.isDefaultConfirmation(e))return;this.delete(e,t)};this.delete=function(t,n){var r=this,i=gfAjaxSpinner(jQuery(n).parents("td").find("strong"),gf_vars.baseUrl+"/images/spinner.gif");if(t&&t!="new")jQuery.post(ajaxurl,{form_id:e.id,confirmation_id:t,action:"gf_delete_confirmation",gf_delete_confirmation:gf_delete_confirmation},function(e){i.destroy();if(!e){alert(r._labels.issueDeleting);return}delete r.confirmations[t];r.deleteRow(t)});else{delete r.confirmations[t];r.deleteRow(t)}};this.deleteRow=function(e){var t=jQuery("tr#confirmation-"+e);t.remove()};this.getConfirmationFromUI=function(){var e=new this.confirmationObj(this);e.id=jQuery("input#confirmation_id").val();e.name=jQuery("input#form_confirmation_name").val();e.type=jQuery('input[name="form_confirmation"]').filter(":checked").val();e.message=jQuery("textarea#form_confirmation_message").val();jQuery("input#form_disable_autoformatting").prop("checked")?e.disableAutoformat=jQuery("input#form_disable_autoformatting").val():e.disableAutoformat="";e.pageId=jQuery("select#form_confirmation_page").val();e.url=jQuery("input#form_confirmation_url").val();jQuery("input#form_redirect_use_querystring").prop("checked")?e.queryString=jQuery("#form_redirect_querystring").val():e.queryString="";jQuery("input#confirmation_conditional_logic").prop("checked")&&(e.conditionalLogic=this._tempConf.conditionalLogic);return e};this.isDefaultConfirmation=function(e){return e=="new"?!1:this.confirmations[e]&&this.confirmations[e].isDefault};this.confirmationObj=function(e){this.id="new";this.name=e._labels.defaultName;this.type="message";this.message=e._labels.defaultMessage,this.isDefault=0};this.init()};