jQuery(function(e){var t,n=e("#tmpl-rwmb-image-advanced").html();e("body").on("click",".rwmb-image-advanced-upload",function(r){r.preventDefault();var i=e(this),s=i.siblings(".rwmb-images"),o=s.data("max_file_uploads"),u=o>1?rwmbFile.maxFileUploadsPlural:rwmbFile.maxFileUploadsSingle;u=u.replace("%d",o);t||(t=wp.media({className:"media-frame rwmb-media-frame",multiple:!0,title:rwmbImageAdvanced.frameTitle,library:{type:"image"}}));t.open();t.off("select");t.on("select",function(){var r=t.state().get("selection").toJSON(),a=s.children().length,f;if(o>0&&a+r.length>o){a<o&&(r=r.slice(0,o-a));alert(u)}r=_.filter(r,function(e){return s.children("li#item_"+e.id).length==0});f=_.pluck(r,"id");if(f.length>0){var l={action:"rwmb_attach_media",post_id:e("#post_ID").val(),field_id:s.data("field_id"),attachment_ids:f,_ajax_nonce:i.data("attach_media_nonce")};e.post(ajaxurl,l,function(e){e.success&&s.append(_.template(n,{attachments:r},{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g})).trigger("update.rwmbFile")},"json")}})})});