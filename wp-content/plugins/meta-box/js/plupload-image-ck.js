jQuery(function(e){function t(t){e("li#"+t.id).addClass("rwmb-image-error").delay(1600).fadeOut("slow",function(){e(this).remove()})}function n(e,t,n){n.removeClass("hidden").append("<li id='"+t.id+"'><div class='rwmb-image-uploading-bar'></div><div id='"+t.id+"-throbber' class='rwmb-image-uploading-status'></div></li>")}function r(t){e("#"+t.id+"-throbber").html("<img class='rwmb-loader' height='64' width='64' src='"+RWMB.url+"img/loader.gif'/>")}e(".rwmb-images").on("click",".rwmb-delete-file",function(){var t=e(this).parents(".rwmb-images").siblings(".rwmb-drag-drop");t.removeClass("hidden")});e(".rwmb-drag-drop").each(function(){var i=e(this),s=i.siblings(".rwmb-uploaded"),o=i.data("js_options"),u={};o.multipart_params=e.extend({_ajax_nonce:i.data("upload_nonce"),post_id:e("#post_ID").val()},o.multipart_params);u=new plupload.Uploader(o);u.init();u.bind("FilesAdded",function(e,o){var u=s.data("max_file_uploads"),a=s.children().length,f=u>1?rwmbFile.maxFileUploadsPlural:rwmbFile.maxFileUploadsSingle;f=f.replace("%d",u);if(u>0&&a+o.length>u){if(a<u){var l=u-a;e.splice(l-1,o.length-l);o=e.files}alert(f)}a+o.length>=u&&i.addClass("hidden");max=parseInt(e.settings.max_file_size,10);plupload.each(o,function(i){n(e,i,s);r(i);i.size>=max&&t(i)});e.refresh();e.start()});u.bind("Error",function(e,r){n(e,r.file,s);t(r.file);e.removeFile(r.file)});u.bind("FileUploaded",function(n,r,i){i=e.parseJSON(i.response);i.success?e("li#"+r.id).replaceWith(i.data):t(r)})})});