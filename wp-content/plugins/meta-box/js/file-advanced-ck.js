jQuery(function(e){var t=e("#tmpl-rwmb-file-advanced").html();e("body").on("click",".rwmb-file-advanced-upload",function(n){n.preventDefault();var r=e(this),i=r.siblings(".rwmb-uploaded"),s=i.data("max_file_uploads"),o=i.data("mime_type"),u=s>1?rwmbFile.maxFileUploadsPlural:rwmbFile.maxFileUploadsSingle,a,f={className:"media-frame rwmb-file-frame",multiple:!0,title:rwmbFileAdvanced.frameTitle};u=u.replace("%d",s);o&&(f.library={type:o});a=wp.media(f);a.open();a.off("select");a.on("select",function(){var n=a.state().get("selection").toJSON(),o=i.children().length,f;if(s>0&&o+n.length>s){o<s&&(n=n.slice(0,s-o));alert(u)}n=_.filter(n,function(e){return i.children("li#item_"+e.id).length==0});f=_.pluck(n,"id");if(f.length>0){var l={action:"rwmb_attach_file",post_id:e("#post_ID").val(),field_id:i.data("field_id"),attachment_ids:f,_ajax_nonce:r.data("attach_file_nonce")};e.post(ajaxurl,l,function(e){e.success&&i.append(_.template(t,{attachments:n},{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g})).trigger("update.rwmbFile")},"json")}})})});